drop program 1_amj_finthrive_missing_claim go
create program 1_amj_finthrive_missing_claim

prompt 
	"Output to File/Printer/MINE" = "MINE"   ;* Enter or select the printer or file name to send this report to.
	, "Bill Number (Claim ID)" = ""          ;* Copy paste the list of claim numbers with quotes and commas between each 

with OUTDEV, bill_nbr_list

free record claim_rec
record claim_rec
(
	1 cnt = i4
	1 claims[*]
		2 encntr_id					= f8
		2 claim_id 					= vc
		2 transmission_dttm			= vc
		2 gen_dttm					= vc
		2 submit_dttm 				= vc
		2 corsp_activity_id			= f8
		2 bill_reltn_id				= f8
		2 bo_hp_reltn_id			= f8
		2 benefit_order_id			= f8
		2 pft_acct_id				= f8
		2 pft_active_ind			= f8
		2 pft_active_status_dttm	= vc
)


declare ccnt 	= i4
declare pos 	= i4
declare num 	= i4

;31 claims
select  into $outdev
	BR.bill_nbr_disp,BR.gen_dt_tm, BR.transmission_dt_tm, BR.submit_dt_tm
from 
	bill_rec br
;	,bill_reltn                     breltn
;	,bo_hp_reltn                    bhr    
;	,benefit_order                  bo  
;	,pft_encntr                     pe
;	,encounter                      e
plan br
	where (br.transmission_dt_tm between CNVTDATETIME(CURDATE-600,CURTIME3) AND CNVTDATETIME(CURDATE-1,CURTIME3)
	OR BR.gen_dt_tm between CNVTDATETIME(CURDATE-600,CURTIME3) AND CNVTDATETIME(CURDATE-1,CURTIME3)
	OR BR.submit_dt_tm between CNVTDATETIME(CURDATE-600,CURTIME3) AND CNVTDATETIME(CURDATE-1,CURTIME3) )
;	and br.bill_nbr_disp_key = "3007202186"
;	and br.bill_nbr_disp_key in ("3007202186","3007259985","3007357188","3007442336","3007458602","3007461305"
;	,"3007488180","3007497728","3007527195","3007565914","3007574167","3007574463","3007581929","3007581983"
;	,"3007584758","3007628731","3007636826","3007675658","3007779380","3007793193","3007822507","3007960939"
;	,"3008013039","3008013371","3008020589","3008020748","3008061017"	
;	)
;	AND br.bill_nbr_disp_key in (
;"3010133109"
;,"3007371871","3009880831","3009419925","3008393103","3009653461","3008393100","3010133123","3008859047"
;,"3009367468","3008334259","3009100441","3007371807","3007841931","3007618910","3008092503","3008597022"
;,"3008990485","3009653464","3009880924","3007445109","3007628237","3007497828","3007639637","3007694179"
;,"3008756864","3008763257","3008807938","3008843372","3009692129","3007569202","3008896810","3009038763"
;,"3007270300","3007552159","3009289870","3009119859","3009169597","3010175991","3008465973","3007889732"
;,"3009377662","3009602648","3008731169","3008791649","3007889820","3009050124","3009299167","3009959587"
;,"3009065293","3008528540","3009050052","3008875029","3008868899","3010133318","3007913923","3010022471"
;,"3010133163","3007770527","3009410379","3008588112","3009725460","3009906637","3009437701","3008639133"
;,"3009119916","3008008250","3009622296","3009367320","3009849614","3008793446","3007574167","3008817407"
;,"3007560828","3007574151","3007371820","3007522437","3007637031","3009161370","3009100382","3009313565"
;,"3008859001","3008596841","3008743898","3007270244","3007398817","3009884588","3009455405","3007468783"
;,"3007716281","3007357241","3007788099","3008312896","3008381934","3009230076","3008355058","3008354891"
;,"3008456333","3008092653","3007716192","3007306504","3009562997","3007247535","3008814102","3008639336"
;,"3008887803","3008181984","3007303633","3007290372","3009900985","3007669521","3007196916","3008015968"
;,"3008020740","3008020748","3008181981","3008195278","3007675658","3008999944","3007788065","3007958270"
;,"3007999798","3007522452","3008277155","3007239466","3007522430","3007779472","3008013039","3008834834"
;,"3010133045","3007530049","3010144267","3009512900","3008548660","3008630331","3009205522","3009950707"
;,"3007414783","3007497724","3007497728","3007290465","3007622654","3008055007","3008465913","3008948354"
;,"3009419932","3009892021","3007321348","3007461306","3007461305","3009434573","3009716449","3009880891"
;,"3009349248","3008861793","3008123315","3008232618","3009683356","3008596794","3008868858","3008739105"
;,"3009647867","3009119840","3009485251","3009470301","3008498516","3009215100","3007796194","3007196810"
;,"3007622569","3007880829","3007364760","3007263020","3008308082","3008456236","3009128763","3009534466"
;,"3009534462","3008990627","3008871137","3007560762","3007610055","3009554704","3007522484","3008113946"
;,"3007968614","3009613555","3008896706","3007527095","3007898158","3007577306","3007188705","3008779571"
;,"3007247534","3007259985","3010066922","3007622419","3008664124","3007848873","3009934144","3007196867"
;,"3007537438","3008423330","3009666064","3008038452","3009666070","3009169652","3008871098","3007935717"
;,"3009137086","3007968581","3008914707","3007417495","3010136810","3009027358","3009975985","3009880781"
;,"3007169159","3008173198","3007255286","3007527164","3008414908","3007678379","3007787987","3007506357"
;,"3007793193","3008630253","3008005426","3007371964","3008901979","3007161864","3008840042","3008834915"
;,"3008925865","3007458602","3007453045","3009596583","3009321912","3009100386","3009025628","3007569059"
;,"3007154083","3007393640","3008747543","3008490712","3007247554","3009299184","3007442336","3008579105"
;,"3009299183","3009596581","3007560842","3008396262","3007424959","3009196834","3009416657","3009175754"
;,"3008131861","3008123486","3008159538","3008355073","3008465930","3008567080","3007202255","3010092540"
;,"3009410516","3009534406","3009410525","3008929585","3009416811","3008905271","3009046747","3009416810"
;,"3009539878","3009589272","3009615373","3008831612","3007506159","3008656106","3007527195","3008744271"
;,"3009667694","3009488241","3009301254","3007856806","3008198819","3009479582","3009657295","3010084268"
;,"3007841866","3009084490","3008664300","3008878612","3008399011","3008941183","3007812177","3008345374"
;,"3008345280","3008092685","3009967874","3008747544","3008731121","3008109026","3008109022","3007770663"
;,"3007613366","3007581960","3007357190","3007306516","3007701630","3007357188","3008567058","3008396419"
;,"3008466055","3008055191","3007770542","3008061017","3009429106","3009766121","3009884359","3009488244"
;,"3009119869","3008466053","3008653255","3009925783","3007196872","3007409850","3007669596","3007944406"
;,"3008139697","3008198701","3008588192","3008808187","3008939331","3009188200","3009239797","3009358535"
;,"3009707192","3010176054","3007730728","3007209558","3007577247","3007581929","3007569173","3008139733"
;,"3008456336","3008531062","3008531058","3007401940","3007803766","3008173213","3008241595","3008836405"
;,"3009406747","3009245680","3009406744","3009653526","3009239697","3010133079","3009653527","3010149409"
;,"3009325089","3009959466","3009426283","3009100484","3010149410","3009881008","3009434486","3009406748"
;,"3008055038","3010144271","3009437709","3009377755","3009377754","3008222652","3009602753","3009797031"
;,"3009587100","3008957509","3007514803","3009671682","3007298791","3009537998","3009680056","3009671311"
;,"3009657280","3008269136","3007842042","3009349261","3008092509","3009355078","3009854612","3009849565"
;,"3007144422","3007569139","3009429122","3007833618","3007999842","3010124131","3009725380","3009947467"
;,"3009725387","3009947464","3010025322","3007935688","3008008272","3008013371","3008950635","3008868890"
;,"3008808163","3008868893","3009289856","3009941548","3008647880","3008905281","3009716596","3007800792"
;,"3009792200","3007880978","3007669544","3007263034","3009364239","3007749322","3009429079","3008546851"
;,"3008456310","3008139817","3007830448","3007584660","3009613542","3008222771","3008707364","3009707272"
;,"3009196694","3009188210","3009068161","3009068158","3008898176","3009155012","3010322483","3009496585"
;,"3007306625","3008063994","3009169538","3009034002","3007514759","3007669622","3008939183","3009196704"
;,"3008948203","3009202271","3009416621","3007708102","3009377757","3007298765","3008588186","3008630299"
;,"3009265546","3007334499","3008804405","3008556113","3009257111","3007196819","3007514772","3007622495"
;,"3008939365","3009008853","3009119873","3008826136","3008354923","3008248908","3008423331","3008273685"
;,"3008740103","3009265559","3009265555","3007833637","3007236422","3008248995","3009410404","3009470316"
;,"3009707095","3009325110","3009563000","3008896813","3009481524","3008759136","3007749180","3007822507"
;,"3008412550","3008412548","3008510052","3009884387","3008578924","3009741817","3009950729","3010013990"
;,"3007239457","3009229925","3009479392","3009470287","3009891905","3009766015","3009488311","3007453119"
;,"3009707106","3009289785","3008084638","3007631424","3010133419","3009906633","3008522360","3007260292"
;,"3007202186","3007196778","3009429151","3009840744","3009005819","3008707400","3009169739","3009008955"
;,"3008887825","3008766117","3008826082","3008647848","3008713168","3009437786","3008406157","3008630077"
;,"3008804414","3007204936","3009784057","3008869054","3009496507","3008704433","3010185662","3008123301"
;,"3009596584","3007716114","3008432024","3007196865","3008423229","3010017106","3007417413","3008704430"
;,"3008630333","3009733471","3009416633","3009657130","3009386246","3009716517","3009906623","3009880978"
;,"3010133099","3009965012","3007401901","3009410431","3008630328","3008661137","3008031110","3007247616"
;,"3009891897","3010144278","3007349243","3007393636","3008228956","3007204818","3007476735","3009683312"
;,"3007631423","3009429152","3008648007","3008707394","3008826257","3009525218","3009496596","3008347448"
;,"3009112395","3009100490","3009230024","3009858488","3009919144","3008115829","3008548548","3007306522"
;,"3009434875","3009316540","3007461324","3009707099","3007514827","3007779475","3009364407","3009891904"
;,"3009999592","3010133282","3007694199","3007779386","3007779380","3007738810","3008312863","3008531076"
;,"3008575720","3009133844","3008456421","3007793490","3008704345","3007552094","3008653547","3007118256"
;,"3007357181","3007519876","3008531085","3007341160","3008055044","3008232617","3009068152","3008704344"
;,"3008653546","3007514739","3008531089","3008653549","3008698208","3007716073","3009926690","3007537445"
;,"3008466074","3007196809","3007247600","3007453036","3008579036","3007913858","3007188701","3009666202"
;,"3009780762","3009917913","3009741833","3008051956","3009775169","3009100399","3009299160","3007144362"
;,"3010182121","3008935521","3008645315","3009653903","3008120116","3007683854","3007856550","3008308123"
;,"3008092538","3008858989","3008334297","3008369438","3007604363","3008656076","3007841909","3009406756"
;,"3009897568","3008779509","3010182120","3007414954","3007290397","3008136692","3008139764","3008286387"
;,"3008396383","3008731033","3009008850","3009248797","3009504862","3010025324","3009426175","3009897776"
;,"3010182119","3010084387","3008369439","3007414952","3009100455","3007669489","3009849615","3010133311"
;,"3007537462","3008607012","3009707080","3009289888","3008957517","3010008595","3007551988","3008766058"
;,"3008813839","3007988580","3008483226","3008198726","3008129276","3008566957","3007169122","3008232627"
;,"3009900823","3007581983","3007577222","3007522549","3008878437","3007733909","3007631409","3007636826"
;,"3007196822","3008639342","3008935951","3009185243","3007952995","3008020589","3007889845","3009100449"
;,"3008707240","3008354962","3007889847","3008528569","3008901996","3008887737","3007453011","3007842093"
;,"3007154204","3008173071","3008664248","3007530057","3008766094","3009059466","3009257115","3008490660"
;,"3008753754","3008585363","3009248772","3008757033","3009022124","3007488180","3008596957","3009147129"
;,"3008704389","3008173211","3008420844","3010025308","3007341078","3009917905","3008345191","3009367573"
;,"3008396308","3009622354","3009881042","3010133196","3007622529","3007628731","3010133143","3008334307"
;,"3009100415","3009622327","3010182191","3009964744","3009666076","3008076615","3009316537","3009226566"
;,"3009683278","3009226565","3008076616","3009068125","3008129191","3007788055","3008536927","3008513517"
;,"3007960939","3007968572","3009257129","3008483173","3010133053","3007833543","3008536950","3009299259"
;,"3009596744","3008295061","3008415004","3008420527","3009281644","3009229949","3009325075","3009840658"
;,"3007290446","3007537502","3009783927","3007733833","3007833607","3009647832","3008581194","3008606984"
;,"3008774390","3008578956","3009128785","3009563044","3008661080","3007497776","3008698211","3007569175"
;,"3008579026","3007574463","3007999828","3008228649","3007999829","3008061044","3008948321","3007497706"
;,"3008522258","3007188643","3007458315","3007357217","3009470254","3009707264","3007478228","3009128757"
;,"3008878567","3008990549","3008929640","3008990545","3009202199","3008974411","3008810200","3009865865"
;,"3007584760","3007749250","3008311047","3007953033","3007584758","3007371914","3007103282","3007552041"
;,"3007565914","3007619509","3007770538","3007581982","3008456280","3008594027","3009386356","3009236426"
;,"3007270242","3008423328","3009977535","3009446030","3009076287","3008965966","3007548610","3008596893"
;,"3009133899","3009420009","3009613498","3008965943","3009554700","3009666095","3009349251","3009671400"
;,"3008296679","3009716564","3010133315","3008688841","3007701585","3008286399","3010008546","3008606969"
;,"3008935587","3008639328","3007239424","3007349181","3007537468","3007880987","3007968636","3008163296"
;,"3008198695","3008277312","3008310988","3008562215","3008490632","3008826100","3009169578","3009196724"
;,"3009307944","3009358587","3009419940","3009479525","3009613512","3009900868","3010144275","3009587213")

ORDER BY BR.gen_dt_tm
head report
	ccnt = 0
detail
	ccnt = ccnt + 1
	stat = alterlist(claim_rec->claims,ccnt)
	claim_rec->claims[ccnt].claim_id 			= br.bill_nbr_disp_key
	claim_rec->claims[ccnt].transmission_dttm 	= format(br.transmission_dt_tm, "@SHORTDATETIME")
	claim_rec->claims[ccnt].gen_dttm 			= format(br.gen_dt_tm, "@SHORTDATETIME")
	claim_rec->claims[ccnt].submit_dttm 		= format(br.submit_dt_tm, "@SHORTDATETIME")
	claim_rec->claims[ccnt].corsp_activity_id 	= br.corsp_activity_id
foot report
	claim_rec->cnt = ccnt
	;stat = alterlist(claim_rec->claims,ccnt)
WITH TIME = 30, FORMAT(DATE,"@SHORTDATETIME"),format, separator = " "

CALL ECHOJSON(CLAIM_REC, $outdev)	

select into $outdev
breltn.corsp_activity_id
,bhr.* 
from
	bill_reltn                     breltn
	,bo_hp_reltn                    bhr    
	,benefit_order                  bo  
;	,pft_encntr                     pe
;	,encounter                      e
;	,dummyt d1
;	,dummyt d2
;	,dummyt d3
;	,dummyt d4
plan breltn 	;started with the original 889 records from query 2  
	where expand(num,1,claim_rec->cnt,breltn.corsp_activity_id,claim_rec->claims[num].corsp_activity_id)
;	where breltn.corsp_activity_id = br.corsp_activity_id
	and breltn.parent_entity_name = "BO_HP_RELTN"
	and breltn.active_ind = 1
;join d1
join bhr		;join without outerjoin went down to 886
	where bhr.bo_hp_reltn_id = breltn.parent_entity_id
    and bhr.active_ind = 1
    and bhr.beg_effective_dt_tm <= cnvtdatetime(curdate,curtime3)
    and bhr.end_effective_dt_tm >= cnvtdatetime(curdate,curtime3)	
;;join d2    
join bo
  	where bo.benefit_order_id = bhr.benefit_order_id
    and bo.end_service_dt_tm >= cnvtdate(12302100)
    and bo.parent_bo_id = 0.0
;    and bo.active_ind = 1 
;;join d3
;join pe
;	where pe.pft_encntr_id = bo.pft_encntr_id
   ; and pe.active_ind = 1 	
;join d4
;join e	
;	where e.encntr_id = pe.encntr_id
	;and pe.active_ind = 1
;head report
;	pos = 0
;detail
;	pos = locateval(num,1,claim_rec->cnt,breltn.corsp_activity_id,claim_rec->claims[num].corsp_activity_id)
;	
;	claim_rec->claims[pos].bo_hp_reltn_id 			= breltn.bill_reltn_id
;	claim_rec->claims[pos].benefit_order_id 		= bo.benefit_order_id
;	claim_rec->claims[pos].pft_acct_id 				= pe.acct_id
;	claim_rec->claims[pos].pft_active_ind 			= pe.active_ind
;	claim_rec->claims[pos].pft_active_status_dttm 	= format(pe.active_status_dt_tm, "@SHORTDATETIME")
;	claim_rec->claims[pos].encntr_id				= e.encntr_id
;
WITH TIME = 30, format, separator = " ", FORMAT(DATE,"@SHORTDATETIME")
,outerjoin = d1, dontcare = d1
,outerjoin = d2, dontcare = d2
,outerjoin = d3, dontcare = d3

;
;SELECT INTO $OUTDEV
;	TOTAL_CLAIMS 			= claim_rec->cnt
;	,ENCNTR_ID				= claim_rec->claims[d1.seq].encntr_id
;	,CLAIM_ID				= claim_rec->claims[d1.seq].claim_id 
;	,TRANSMISSION_DATE		= claim_rec->claims[d1.seq].transmission_dttm 
;	,GENERATE_DATE			= claim_rec->claims[d1.seq].gen_dttm 
;	,SUBMIT_DATE			= claim_rec->claims[d1.seq].submit_dttm 
;	,CORSP_ACT_ID			= claim_rec->claims[d1.seq].corsp_activity_id 
;	,BILL_RELTN_ID			= claim_rec->claims[d1.seq].bill_reltn_id 
;	,BO_HP_RELTN_ID			= claim_rec->claims[d1.seq].bo_hp_reltn_id 
;	,BENEFIT_ORDER_ID		= claim_rec->claims[d1.seq].benefit_order_id 
;	,ACCT_ID				= claim_rec->claims[d1.seq].pft_acct_id 
;	,ACTIVE_IND				= claim_rec->claims[d1.seq].pft_active_ind 
;	,ACTIVTE_STATUS_DATE	= claim_rec->claims[d1.seq].pft_active_status_dttm 
;FROM 
;(dummyt d1 with seq = value(claim_rec->cnt))
;plan d1
;where claim_rec->claims[d1.seq].encntr_id >= 1
;with nocounter, format, separator = " "
;
;;
;;SELECT 
;;PAYER_CONTROL_NUMBER = BR.payor_ctrl_nbr_txt
;;,INDEX2 = BR.bt_cond_result_id
;;,INDEX3 = BR.batch_event_id
;;,INDEX4 = BR.gen_reason_cd
;;,INDEX4_DISP = UAR_GET_CODE_DISPLAY(BR.gen_reason_cd)
;;,INDEX5 =br.image_flag
;;,INDEX6_1 = br.billing_entity_id
;;,INDEX6_2 = br.bill_status_cd
;;,INDEX6_2_DISP = UAR_GET_CODE_DISPLAY(br.bill_status_cd)
;;,INDEX7 = BR.gen_dt_tm					;date time 
;;,INDEX8 = br.transmission_dt_tm			;date time 
;;,INDEX9 = br.submit_dt_tm				;date time 
;;,XIF4 = br.bill_nbr_disp_key
;;,XIF5 = br.bill_nbr_disp
;;,XPK1 = br.corsp_activity_id
;;,XPK2 = br.bill_vrsn_nbr
;;FROM BILL_REC BR
;;PLAN BR
;;WHERE BR.gen_dt_tm >= CNVTDATETIME(CURDATE-10,CURTIME3)
;;AND BR.gen_dt_tm <= CNVTDATETIME(CURDATE-9,CURTIME3)
;;and br.payor_ctrl_nbr_txt > " "
end
go
